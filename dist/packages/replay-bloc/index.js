"use strict";var _=Object.defineProperty;var y=(s,t,i)=>t in s?_(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var h=(s,t,i)=>(y(s,typeof t!="symbol"?t+"":t,i),i);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("@jacobtipp/bloc");class o{constructor(t,i){h(this,"_history",[]);h(this,"_redos",[]);this._shouldReplay=t,this.limit=i}get canRedo(){return this._redos.some(t=>this._shouldReplay(t.newValue))}get canUndo(){return this._history.some(t=>this._shouldReplay(t.oldValue))}add(t){this.limit!==void 0&&this.limit===0||(this._history.push(t),this._redos=[],this.limit!==void 0&&this._history.length>this.limit&&this.limit>0&&this._history.shift())}clear(){this._history=[],this._redos=[]}redo(){if(this.canRedo){const t=this._redos.shift();if(t)return this._history.push(t),this._shouldReplay(t.newValue)?t.execute():this.redo()}}undo(){if(this.canUndo){const t=this._history.pop();if(t)return this._redos.unshift(t),this._shouldReplay(t.oldValue)?t.undo():this.undo()}}}class a{constructor(t,i,e,n){h(this,"execute",()=>this._execute());h(this,"undo",()=>this._undo(this.oldValue));this.oldValue=t,this.newValue=i,this._execute=e,this._undo=n}}class r{constructor(){h(this,"_")}}class u extends r{}class l extends r{}const p=s=>class extends s{constructor(...e){super(...e);h(this,"_changeStack",new o(this.shouldReplay.bind(this)));this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.clearHistory=this.clearHistory.bind(this)}onTransition(e){super.onTransition(e)}onEvent(e){super.onEvent(e)}emit(e){this._changeStack.add(new a(this.state,e,()=>{const n=new u;this.onEvent(n),this.onTransition(new d.Transition(this.state,n,e)),super.emit(e)},n=>{const c=new l;this.onEvent(c),this.onTransition(new d.Transition(this.state,c,n)),super.emit(n)})),super.emit(e)}undo(){this._changeStack.undo()}redo(){this._changeStack.redo()}get canUndo(){return this._changeStack.canUndo}get canRedo(){return this._changeStack.canRedo}clearHistory(){return this._changeStack.clear()}set limit(e){this._changeStack.limit=e}shouldReplay(e){return!0}},g=s=>class extends s{constructor(...e){super(...e);h(this,"_changeStack",new o(this.shouldReplay.bind(this)));this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.clearHistory=this.clearHistory.bind(this)}emit(e){this._changeStack.add(new a(this.state,e,()=>super.emit(e),n=>super.emit(n))),super.emit(e)}undo(){this._changeStack.undo()}redo(){this._changeStack.redo()}get canUndo(){return this._changeStack.canUndo}get canRedo(){return this._changeStack.canRedo}clearHistory(){return this._changeStack.clear()}set limit(e){this._changeStack.limit=e}shouldReplay(e){return!0}};exports.Change=a;exports.ChangeStack=o;exports.RedoEvent=u;exports.ReplayEvent=r;exports.UndoEvent=l;exports.WithReplayBloc=p;exports.WithReplayCubit=g;
